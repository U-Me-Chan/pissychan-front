# Pissychan

Pissychan - это фронтенд к бэкенду имиджборды под названием pissykaka.

## Запуск приложения

```
NODE_ENV=production npm start
```

## Руководство по работе с кодовой базой

Установите все зависимости:

```
npm install
```

Так же в ходе установки зависимостей будут установлены пре-коммит хуки,
реализуемые пакетом `husky`. Пре-коммит хуки позволяют перед коммитом проверять
весь новый код на соответствие выбранному для данного проекта кодстайлу.

Пожалуйста, не пренебрегайте замечаниями линтера и исравляйте их. Перед
завершением работ в рамках пулреквеста убедитесь, что по крайней мере линтер не
имеет претензий к коду. Пре-коммит хуки призваны помочь вам в этом в режиме
регулярной профилактики.

Для удобства можно установить `nodemon`, чтобы сервер перезапускался после
любых изменений в коде приложения. `nodemon` не заявлен в списках зависимостей,
так как является полностью опциональным.

```
npm install --global nodemon
```

Запускать приложение с использованием `nodemon` можно следующим образом:

```
nodemon
```

или, если директория `bin` глобального префикса NPM не прописана в переменную
окружения `PATH` вашего шелла, то

```
$(npm prefix -g)/bin/nodemon
```

Подробнее об использовании `nodemon` можно почитать
[здесь](https://www.digitalocean.com/community/tutorials/workflow-nodemon).

## Особенности настройки NginX reverse proxy для Писсичана

С появлением возможности удаления своих постов (https://github.com/U-Me-Chan/pissychan-front/pull/50) при большом количестве накопленных паролей NginX начинает отвечать клиенту `502`, а в логе `/var/log/nginx/error.log` ругаться на большие хедеры:

```
2023/05/17 18:11:24 [error] 1998#1998: *1668 upstream sent too big header while reading response header from upstream
```

В качестве решения можно увеличить прокси буферы в `/etc/nginx/nginx.conf`:

```
# https://stackoverflow.com/q/25762111
proxy_buffer_size 128k;
proxy_buffers 4 256k;
proxy_busy_buffers_size 256k;
```

Для возможности корректной загрузки изображений лучше увеличить максимальный
объём body от клиента до нескольких десятков мегабайт (в `/etc/nginx/nginx.conf`):

```
client_max_body_size 100M;
```
